{# templates/accounts/includes/profile_card_partial.html #}
{# This partial renders a single profile card. It expects 'profile' and 'current_user' as context. #}

{% if profile %}
<div id="profile-card" 
     data-username="{{ profile.username }}"
     class="absolute w-full h-full bg-white rounded-2xl shadow-xl flex flex-col overflow-hidden transform transition-transform duration-300 ease-out cursor-grab active:cursor-grabbing"
     style="touch-action: none;"> {# Prevent default touch actions like scrolling #}

    {% if profile.profile_picture %}
        <img src="{{ profile.profile_picture.url }}" alt="{{ profile.username }}'s Profile Picture"
             class="w-full h-2/3 object-cover object-center">
    {% else %}
        <div class="w-full h-2/3 bg-gray-200 flex items-center justify-center text-gray-500 text-6xl font-bold">
            {{ profile.username.0|upper }}
        </div>
    {% endif %}

    <div class="p-6 flex-grow flex flex-col justify-between">
        <div>
            <h2 class="text-3xl font-bold text-gray-900 mb-2 flex items-center">
                {{ profile.username }}
                {% if profile.is_premium %}
                    <span class="ml-2 bg-gradient-to-r from-yellow-400 to-yellow-600 text-white text-xs font-bold px-2 py-0.5 rounded-full shadow-md">
                        VIP
                    </span>
                {% endif %}
            </h2>
            <p class="text-xl text-gray-700 mb-2">
                {% if profile.get_age %}{{ profile.get_age }} years old{% else %}Age not set{% endif %}
                {% if profile.location %}, {{ profile.location }}{% endif %}
            </p>
            <p class="text-sm text-gray-600 mb-4 italic">{{ profile.get_user_type_display }}</p>
            <p class="text-gray-800 text-sm overflow-hidden text-ellipsis h-16">{{ profile.bio|truncatechars:150|default:"No bio available." }}</p>
        </div>
        
        <div class="mt-4 flex justify-between gap-4">
            <a href="{% url 'view_other_profile' username=profile.username %}" class="btn btn-secondary flex-1">View Profile</a>
            {% if current_user.is_premium %}
                <a href="{% url 'message_gate' username=profile.username %}" class="btn btn-primary flex-1">Message</a>
            {% endif %}
        </div>
    </div>
</div>
{% else %}
    {# This block is rendered if no profile is found for the partial (e.g., end of profiles) #}
    <div class="text-center text-lg text-gray-600 w-full">
        No more profiles to browse. Check back later!
        <div class="mt-4 flex flex-col items-center space-y-3">
            <a href="{% url 'browse_profiles' %}" class="btn btn-secondary">Go to Grid Browse</a>
            <a href="{% url 'matches' %}" class="btn btn-primary">View My Matches</a>
        </div>
    </div>
{% endif %}
